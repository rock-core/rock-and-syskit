<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta charset="utf-8">
        <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Building Robots with Rock and Syskit</title>

        <link href="../images/favicon.ico" rel="icon" type="image/ico" relative="true" />
        <link href="../stylesheets/site.css" rel="stylesheet" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>

    <body class="log_management log_management_datastore">
            <!-- top navbar -->
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="../">Home</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3" role="complementary">
                <nav class="docs-sidebar" data-spy="affix">
                    <ul class="nav"><li class='child'><a href="../">Building robots with Rock and Syskit</a></li><li class='parent'><span class='parent-label'><a href="../basics/">Basics</a></span><ul><li class='child'><a href="../basics/">Introduction</a></li><li class='child'><a href="../basics/installation.html">Installation</a></li><li class='child'><a href="../basics/day_to_day.html">Day-to-day Workspace Commands</a></li><li class='child'><a href="../basics/getting_started.html">Getting Started</a></li><li class='child'><a href="../basics/composition.html">Compositions</a></li><li class='child'><a href="../basics/constant_generator.html">Constant Generator</a></li><li class='child'><a href="../basics/devices.html">Profiles and Devices</a></li><li class='child'><a href="../basics/deployment.html">Deployment</a></li><li class='child'><a href="../basics/publishing.html">Publishing</a></li><li class='child'><a href="../basics/validation.html">Configuration Consistency</a></li><li class='child'><a href="../basics/recap.html">Recap</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../runtime_overview/">Runtime Overview</a></span><ul><li class='child'><a href="../runtime_overview/">Introduction</a></li><li class='child'><a href="../runtime_overview/task_structure.html">Task Structures</a></li><li class='child'><a href="../runtime_overview/event_loop.html">Event Loop</a></li><li class='child'><a href="../runtime_overview/exceptions.html">Errors</a></li><li class='child'><a href="../runtime_overview/live_data.html">Live Data Visualization</a></li><li class='child'><a href="../runtime_overview/recap.html">Recap</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../workspace/">Workspace and Packages</a></span><ul><li class='child'><a href="../workspace/">Introduction</a></li><li class='child'><a href="../workspace/conventions.html">Conventions</a></li><li class='child'><a href="../workspace/setup.html">Starting a New Project</a></li><li class='child'><a href="../workspace/add_packages.html">Adding new packages</a></li><li class='child'><a href="../workspace/os_dependencies.html">OS Dependencies</a></li><li class='child'><a href="../workspace/global_configuration.html">Global Configuration</a></li><li class='child'><a href="../workspace/testing.html">Test Integration</a></li><li class='child'><a href="../workspace/managing.html">Build configuration design</a></li><li class='child'><a href="../workspace/troubleshooting.html">Troubleshooting</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../libraries/">Libraries</a></span><ul><li class='child'><a href="../libraries/">Introduction</a></li><li class='child'><a href="../libraries/add_packages.html">Add packages</a></li><li class='child'><a href="../libraries/cpp_libraries.html">C++ Library Packages</a></li><li class='child'><a href="../libraries/geometric_transformations.html">Geometric Transformations in C++ Libraries</a></li><li class='child'><a href="../libraries/ruby_libraries.html">Ruby Library Packages</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../components/">Components</a></span><ul><li class='child'><a href="../components/">Writing Components</a></li><li class='child'><a href="../components/orogen_packages.html">oroGen Packages</a></li><li class='child'><a href="../components/defining_types.html">Defining Types</a></li><li class='child'><a href="../components/importing_types.html">Importing Types</a></li><li class='child'><a href="../components/interface.html">Interface</a></li><li class='child'><a href="../components/state_machine.html">State Machine</a></li><li class='child'><a href="../components/writing_the_hooks.html">Writing the Hooks</a></li><li class='child'><a href="../components/timestamping.html">Timestamping</a></li><li class='child'><a href="../components/stream_aligner.html">Stream Aligner</a></li><li class='child'><a href="../components/geometric_transformations.html">Geometric Transformations</a></li><li class='child'><a href="../components/deployment.html">Deployments</a></li><li class='child'><a href="../components/runtime.html">Runtime</a></li><li class='child'><a href="../components/testing.html">Testing</a></li><li class='child'><a href="../components/types_in_ruby.html">Types in Ruby</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../component_networks/">Designing Component Networks</a></span><ul><li class='child'><a href="../component_networks/">Introduction</a></li><li class='child'><a href="../component_networks/composition.html">Compositions</a></li><li class='child'><a href="../component_networks/profiles.html">Profiles</a></li><li class='child'><a href="../component_networks/reusable_networks.html">Reusable Networks</a></li><li class='child'><a href="../component_networks/devices_and_busses.html">Robot definition&colon; Devices and Busses</a></li><li class='child'><a href="../component_networks/dynamic_services.html">Dynamic Services</a></li><li class='child'><a href="../component_networks/geometric_transformations.html">Geometric Transformations</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../coordination/">Coordination</a></span><ul><li class='child'><a href="../coordination/">Introduction</a></li><li class='child'><a href="../coordination/generalities.html">Generalities</a></li><li class='child'><a href="../coordination/tasks_and_events.html">Tasks and Events</a></li><li class='child'><a href="../coordination/action_methods.html">Action Methods</a></li><li class='child'><a href="../coordination/action_state_machines.html">Action State Machines</a></li><li class='child'><a href="../coordination/component_networks.html">Component Networks</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../simulation/">Simulation with Gazebo</a></span><ul><li class='child'><a href="../simulation/">Introduction</a></li><li class='child'><a href="../simulation/models_links_and_joints.html">Models, Links, Joints and Sensors</a></li><li class='child'><a href="../simulation/plugins.html">Plugins</a></li><li class='child'><a href="../simulation/transformer.html">Transformer</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../syskit_error_handling/">Error Handling</a></span><ul><li class='child'><a href="../syskit_error_handling/">Introduction</a></li></ul></li><li class='parent active'><span class='parent-label'><a href="./">Log Management</a></span><ul><li class='child'><a href="./">Introduction</a></li><li class='child'><a href="runtime.html">Log Generation at Runtime</a></li><li class='child active'><a href="datastore.html">Storing Logs</a></li><li class='child'><a href="jupyter.html">Log Analysis with Jupyter</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../testing/">Testing and Debugging</a></span><ul><li class='child'><a href="../testing/">Introduction</a></li><li class='child'><a href="../testing/component.html">Component Tests</a></li><li class='child'><a href="../testing/integration.html">Integration Tests</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../cookbook/">Cookbook</a></span><ul><li class='child'><a href="../cookbook/">Introduction</a></li><li class='child'><a href="../cookbook/device_drivers.html">Device Drivers with iodrivers_base</a></li><li class='child'><a href="../cookbook/http_api.html">Control and Monitoring through a HTTP API</a></li></ul></li><li class='parent'><span class='parent-label'><a href="../deprecations/">Deprecated Behaviors</a></span><ul><li class='child'><a href="../deprecations/">Introduction</a></li><li class='child'><a href="../deprecations/backward_compatible_naming.html">Backward compatible naming</a></li><li class='child'><a href="../deprecations/update_properties.html">Introduction of the `update_properties` method</a></li></ul></li></ul>
                </nav>
            </div>
            <div class="col-md-9" role="main">
                <h1 class="no_toc" id="storing-logs">Storing Logs</h1>

<ul id="markdown-toc">
  <li><a href="#setting-up-a-datastore" id="markdown-toc-setting-up-a-datastore">Setting up a datastore</a></li>
  <li><a href="#importing-a-dataset" id="markdown-toc-importing-a-dataset">Importing a dataset</a></li>
  <li><a href="#processing-multiple-log-folders" id="markdown-toc-processing-multiple-log-folders">Processing multiple log folders</a></li>
  <li><a href="#listing-and-querying-datasets" id="markdown-toc-listing-and-querying-datasets">Listing and querying datasets</a></li>
</ul>

<p>Given the convention of putting all generated data <a href="runtime.html">in a Syskit instance log
directory</a>, all data that needs to be stored about a given Syskit
execution is present in a single folder. Saving that data means copying that folder.</p>

<p>This is the simplest method to save a successful mission's data: copy the whole
Syskit log folder to save it.</p>

<p>However, the <code>tools/syskit-log</code> package also offers a way to normalize data in a
<em>datastore</em>. In a datastore, the common data of a Syskit run (i.e. Syskit event
log, component properties and output ports) are converted in a normalized form,
creating a dataset. Datasets are immutable, given an immutable ID and can safely
be copied across machines.</p>

<p>All commands related to stores are under the <code>syskit ds</code> command. See <code>syskit help ds</code>
for a list.</p>

<p>Data export and <a href="jupyter.html">analysis</a> functionality from syskit-log rely on
data being converted to a normalized dataset.</p>

<h2 id="setting-up-a-datastore">Setting up a datastore</h2>

<p>A syskit-log datastore is a simple local folder. Just create it. <code>syskit ds</code>
subcommands may be given a datastore explicitly with the <code>--store</code> option or,
preferrably, one sets a global datastore using the SYSKIT_LOG_STORE environment
variable.</p>

<h2 id="importing-a-dataset">Importing a dataset</h2>

<p>To import a dataset, copy the data from your system and process it using <code>syskit
ds import</code>. Using rsync, it would look like</p>

<div class="highlight"><pre class="highlight plaintext"><code>rsync -r --compress REMOTE_URL:/path/to/logs/current .
syskit ds import current "Description of this dataset" \
    --tags a list of tags to refer to the dataset later
</code></pre></div>
<p>Within the store, datasets themselves are stored in the <code>core/</code> folder, under
their full ID. Each dataset has a <code>syskit-dataset.yml</code> file that contains the
identity information for that set (i.e. the hash of the files are used to create
the set ID) as well as the Syskit event log. A <code>pocolog</code> folder contains the
output log files, normalized to a single file per stream, named as
<code>TASK_NAME::PORT_NAME.0.log</code>.</p>

<p>All other files that were contained in the original folder(s) are stored either
in the <code>text/</code> folder (if they are text files) or in the <code>ignored/</code> folder.</p>

<h2 id="processing-multiple-log-folders">Processing multiple log folders</h2>

<p>Each Syskit run creates a new dataset folder. During a day of operation, it is often
the case that multiple datasets have been created. Let's assume you have copied them
all in a single (originally empty) local folder with:</p>

<div class="highlight"><pre class="highlight plaintext"><code>rsync -r --compress REMOTE_URL:/path/to/logs/ .
</code></pre></div>
<p>You may decide to import them all separately in a single run using the <code>--auto</code>
parameter. This will create one dataset per subfolder.</p>

<div class="highlight"><pre class="highlight plaintext"><code>syskit ds import --auto .
</code></pre></div>
<p>Alternatively, all created datasets from the same Syskit app can be imported and
processed together using the <code>--merge</code> option to <code>import</code>. It will create a single
dataset that can be analyzed as a single one later.</p>

<div class="highlight"><pre class="highlight plaintext"><code>syskit ds import --merge .
</code></pre></div>
<h2 id="listing-and-querying-datasets">Listing and querying datasets</h2>

<p>The <code>syskit ds list</code> command will list all datasets currently present in the store,
listed by increasing date (oldest first). The command also accepts ways to restrict
the datasets using its QUERY parameter.</p>

<p>The query is a list of <code>keyOPvalue</code> arguments, where <code>key</code> is one of the metadata
keys (as shown by <code>list</code> without arguments) and <code>OP</code> is either <code>=</code> for strict
equality or <code>~</code> for matching (in which case <code>value</code> is interpreted as a regular
expression).</p>

<p>Metadata of note is <code>roby:time</code>, which is a timestamp of the form
<code>YYYYMMDD-HHMM</code>.  One can for instance show all datasets from August 2020 with
<code>syskit ds list roby:time~202010</code></p>

<p>Once you narrowed down the list of datasets to show, the <code>--pocolog</code> argument
will display all the data streams available within the dataset.</p>

<p>Alternatively to <code>list</code>, <code>find-streams</code> allows to look for specific data streams.
For instance, to look for all <code>/base/Time</code> streams do</p>

<div class="highlight"><pre class="highlight plaintext"><code>syskit ds find-streams type=/base/Time
</code></pre></div>
<p>The <code>--ds-filter</code> argument allows to filter datasets the same way than <code>list</code>
does, i.e. to see all <code>/base/samples/RigidBodyState</code> streams generated during
August 2020,</p>

<div class="highlight"><pre class="highlight plaintext"><code>syskit ds find-streams type~/base/samples/RigidBodyState --ds-filter roby:time~202010
</code></pre></div>
<p class="important"><a href="../components/importing_types.html#opaques">Opaque types</a>, and types that are
derived from them (e.g. structure that have opaques as fields), are stored under
the type name of the intermediate type and not the original type name. For
instance, <code>/base/samples/RigidBodyState</code> is actually stored as
<code>/base/samples/RigidBodyState_m</code> in the log files. If a call to <code>find-streams</code>
does not return any result, check a single dataset to find out whether you
are referring to the right type.</p>

<p>See <code>syskit ds help find-streams</code> for more details.</p>

            </div>
        </div>
    </div>

    <script>
    $('.docs-sidebar').affix({
        offset: {
            top: $('.docs-sidebar').offset().top
        }
    });
    </script>


        <footer class="container-fluid text-center">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">Building Robots with Rock and Syskit</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/doudou" property="cc:attributionName" rel="cc:attributionURL">Sylvain Joyeux</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>. Copyright Sylvain Joyeux and Contributors
        </footer>
    </body>
</html>
